<panel title="Edicion y Visualización de consultas laborales">
    <div class="register-content">
        <form #f="ngForm" (ngSubmit)="creoCita(f)" class="margin-bottom-0">
            <div *ngIf="objAfil != null" class="row row-space-10 m-b-10">
                <label class="control-label col col-md-1">Cédula</label>
                <div class="col col-md-2 m-b-15">
                    <input type="text" [(ngModel)]="objAfil.cedula" name="id_afil" class="form-control" placeholder=""
                        appOnlydigits maxlength="8" disabled />
                </div>
                <div class="col col-md-6">
                    <input *ngIf="objAfil != null && objAfil!=undefined" type="text" [(ngModel)]="objAfil.apellidos"
                        name="nomdis" class="form-control" placeholder="" disabled />
                    <!-- <input type="text" [(ngModel)]="objAfil.nombres" name="nonodis" class="form-control" placeholder="" disabled/> -->
                </div>
            </div>

            <div class="m-b-10">
                <label class="control-label ">Núcleo</label>
                <div>
                    <input type="text" [(ngModel)]="objNucleo.nombre" name="nucleo" class="form-control" disabled />
                </div>

                <label class="control-label ">Motivo</label>
                <div class="m-b-10">
                    <textarea [(ngModel)]="objCita.motivo" name="motivo" class="form-control" rows="3"
                        disabled></textarea>
                </div>
                <div class="row">
                    <div class="col col-md-3">
                        <label class="control-label ">Día y horario de preferencia</label>
                        <div>
                            <input type="text" [(ngModel)]="objCita.prefiere" name="prefiere" class="form-control"
                                disabled />
                        </div>
                    </div>
                    <div class="col col-md-3">
                        <label class="control-label ">Abogado preferencia</label>
                        <div>
                            <input type="text" [(ngModel)]="objCita.abogPrefiere" name="abogprefiere" class="form-control"
                                disabled />
                        </div>
                    </div>
                </div>

            </div>

            <h5 class="m-t-40 border-bottom m-b-30 m-r-10"><i class="fa fa-calendar m-r-10"></i>Datos de Coordinación
            </h5>
            <span *ngIf="quemodocita=='V' || quemodocita == 'C'">
                <div class="row row-space-10 m-b-15">
                    <label class="control-label col col-md-2">Fecha </label>
                    <div class="col-md-2 ">
                        <input type="date" [(ngModel)]="objCita.fecagenda" name="fecha" class="form-control"
                            placeholder="" disabled />
                    </div>

                    <label class="control-label col-md-1">Hora </label>
                    <div class="col-md-2 ">
                        <input type="time" [(ngModel)]="objCita.horagenda" name="hora" class="form-control"
                            placeholder="" disabled />
                    </div>
                </div>
                <div class="row row-space-10 m-b-15">
                    <label class="control-label col col-md-2">Abogado</label>
                    <div class="col-md-4 ">
                        <input *ngIf="objCita.abogado != null " type="text" [(ngModel)]="objCita.abogado.nombre"
                            name="abogado" class="form-control" placeholder="" disabled />
                    </div>
                </div>
            </span>
            <span *ngIf="quemodocita == 'A'">
                <div class="row row-space-10 m-b-15">
                    <label class="control-label col col-md-2">Fecha </label>
                    <div class="col-md-2 ">
                        <input type="date" [(ngModel)]="objCita.fecagenda" (change)="checkCambio('Fecha')" name="fecha" class="form-control"
                            placeholder="" />
                    </div>

                    <label class="control-label col-md-1">Hora </label>
                    <div class="col-md-2 ">
                        <input type="time" [(ngModel)]="objCita.horagenda" (change)="checkCambio('Hora')" name="hora" class="form-control"
                            placeholder="" />
                    </div>
                </div>
                <div class="row row-space-10 m-b-15">
                    <label class="control-label col col-md-2">Abogado</label>
                    <div class="col-md-4">
                        <select *ngIf="abogados !== undefined && objCita.abogado !== undefined" class="form-control"
                            (change)="onChangeAbo($event.target.value)">
                            <option *ngFor="let item of abogados" [selected]="objCita.abogado.id == item.id"
                                [ngValue]="item">{{item.nombre}}</option>
                        </select>
                    </div>
                </div>
            </span>

            <!-- nueva funcionalidad para mostrar historial -->

            <h5 class="m-t-40 border-bottom m-b-30 m-r-10"><i class="fa fa-book m-r-10"></i>Documentación necesaria</h5>
            <div class="row my-4">
                <div class="col-12 m-l-5">
                    <input [disabled]="quemodocita=='V' " #imageInput type="file" accept="/*" (change)="processFile($event)" multiple>
                </div>
                <div class="my-3 table-responsive col-8">
                    <table class="table">
                        <thead>
                            <tr>
                                <th scope="col">Nº</th>
                                <th scope="col">Nombre</th>
                                <th scope="col">fecha</th>
                                <th scope="col">Tamaño</th>
                                <th scope="col" width="20%">
                                    <button type="button" [disabled]="quemodocita=='V'" (click)="openMailCompose(mail)"
                                        class="btn btn-sm btn-primary">Solicitar</button>
                                </th>
                            </tr>
                        </thead>
                        <tbody *ngFor="let item of files; index as index">
                            <tr>
                                <th scope="row">{{index+1}}</th>
                                <td>{{item.name}}</td>
                                <td>{{item.fecha | date:'dd/MM/yyyy HH:MM'}}</td>
                                <td class="byte">{{item.size | number}}</td>
                                <td>
                                    <span data-bs-toggle="tooltip" data-bs-placement="bottom" title="Eliminar adjunto">
                                        <a href="javascript:;" (click)="deleteAdjunto(item,index)"
                                            class="btn btn-danger btn-icon btn-circle btn-sm"><i
                                                class="fa fa-times"></i></a>
                                    </span>
                                    <span class="mx-2" data-bs-toggle="tooltip" data-bs-placement="bottom"
                                        title="Descargar">
                                        <a href="javascript:;" (click)="download(item)"
                                            class="btn btn-success btn-icon btn-circle btn-sm"><i
                                                class="fa fa-download"></i></a>
                                    </span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <h5 *ngIf="historial.length != 0" class="m-t-40 border-bottom m-b-30 m-r-10"><i
                    class="fa fa-tasks m-r-10"></i>Historial de eventos</h5>
            <div *ngIf="historial.length != 0" class="row">
                <div class="my-1 table-responsive col-auto">
                    <cdk-virtual-scroll-viewport style="height: 300px" itemSize="5">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th scope="col">Nº</th>
                                    <th scope="col">Fecha</th>
                                    <th scope="col">Tipo</th>
                                    <th scope="col">Usuario</th>
                                    <th scope="col">Nombre</th>
                                    <th scope="col">Observacion</th>
                                    <th scope="col">Adjuntos</th>
                                </tr>
                            </thead>
                            <tbody *ngFor="let item of historial; index as index">
                                <tr>
                                    <th scope="row">{{index+1}}</th>
                                    <td>{{item.fecha | date:'dd/MM/yyyy'}}</td>
                                    <td>{{item.tipo}}</td>
                                    <td>{{item.usuario}}</td>
                                    <td>{{item.fullname}}</td>
                                    <td>{{item.observaciones}}</td>
                                    <td>{{item.adjuntos.length > 0 ? item.adjuntos : "Sin adjuntos"}}</td>
                                </tr>
                            </tbody>
                        </table>
                    </cdk-virtual-scroll-viewport>
                </div>
            </div>

            <h5 *ngIf="quemodocita=='C' || quemodocita=='V'" class="m-t-40 border-bottom m-b-30 m-r-10"><i class="fa fa-sticky-note m-r-10"></i>Resumen</h5>
            <span *ngIf="quemodocita=='C' || quemodocita=='V'">
                <div class="row row-space-10 m-b-15">
                    <label class="control-label col col-md-2">Notas internas </label>
                    <div class="col-md-10 ">
                        <textarea [(ngModel)]="objCita.notas" [readonly]="quemodocita=='V'" name="notas"
                            class="form-control" placeholder="" rows="3"></textarea>
                    </div>
                </div>
                <div class="row row-space-10 m-b-15">
                    <label class="control-label col col-md-2">Resultado </label>
                    <div class="col-md-10 ">
                        <textarea [(ngModel)]="objCita.resultado" (change)="checkCambio('Resultado')" [readonly]="quemodocita=='V'" name="resul"
                            class="form-control" placeholder="" rows="6"></textarea>
                    </div>
                </div>
            </span>

            <div class="form-group row m-b-15 m-l-40">
                <div class="register-buttons">
                    <button type="button" class="btn btn-white height-30  m-l-20 width-150" title=""
                        (click)="volver()"><span class="fa fa-arrow-left btn-icon mr-2"></span>Volver</button>
                    <button *ngIf="quemodocita != 'V'" type="submit" class="btn btn-white height-30 m-l-20 width-150"
                        title=""><span class="fa fa-check btn-icon mr-2" style="color:darkred"></span>Confirmar</button>
                </div>
            </div>
        </form>
    </div>
    <!-- end register-content -->
</panel>
<!-- end panel -->


<!-- modal para solicitar documentacion -->
<ng-template #mail let-c="close" let-d="dismiss">
    <div class="modal-content">
        <app-mail [para]="para" (closePopup)="d($event)"></app-mail>
    </div>
</ng-template>